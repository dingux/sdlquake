#!/bin/sh

mkdir -p ipkg/home/retrofw/games/quake
mkdir -p ipkg/home/retrofw/apps/gmenu2x/sections/games
cp quakers97.elf ipkg/home/retrofw/games/quake/quake
cp -r id1 ipkg/home/retrofw/games/quake/id1

cd ipkg

# https://unix.stackexchange.com/questions/219268/how-to-add-new-lines-when-using-echo
print()
	case    ${IFS- } in
	(\ *)   printf  %b\\n "$*";;
	(*)     IFS=\ $IFS
	printf  %b\\n "$*"
	IFS=${IFS#?}
esac

# Create GmenuNx entry file plus other things

print 'Package: quake
Version: 20190207
Description: FPS games
Section: games
Priority: optional
Maintainer: gameblabla
Architecture: mipsel
Homepage: https://github.com/gameblabla/sdlquake
Depends:
Source: https://github.com/gameblabla/sdlquake
' > control

print '2.0' > debian-binary

print 'title=Quake
description=FPS game
exec=/home/retrofw/games/quake/quake
clock=600
' > home/retrofw/apps/gmenu2x/sections/games/quake

print 'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACx
jwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVh
ZHlxyWU8AAADIGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78i
IGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9i
ZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4wLWMwNjAgNjEuMTM0Nzc3LCAy
MDEwLzAyLzEyLTE3OjMyOjAwICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93
d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJk
ZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5z
OnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0
cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JU
b29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5p
aWQ6MkE3QzAwMjMyRDUyMTFFMEIwOURCOEZDNEI3OUM5RDAiIHhtcE1NOkRvY3VtZW50SUQ9Inht
cC5kaWQ6MkE3QzAwMjQyRDUyMTFFMEIwOURCOEZDNEI3OUM5RDAiPiA8eG1wTU06RGVyaXZlZEZy
b20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoyQTdDMDAyMTJENTIxMUUwQjA5REI4RkM0Qjc5
QzlEMCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoyQTdDMDAyMjJENTIxMUUwQjA5REI4RkM0
Qjc5QzlEMCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94
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' > home/retrofw/games/quake/quake.png

tar -czvf control.tar.gz control
tar -czvf data.tar.gz home
ar rv ../quake.ipk control.tar.gz data.tar.gz debian-binary

cd ..
rm -r ipkg
